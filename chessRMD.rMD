---
title: "Data607 - Project1"
author: "Vanita Hackworth"
date: "February , 2019"
output: 
  html_document:
  toc: true
---

###read csv and create a character vector 
```{r read-csv, eval=TRUE, echo=FALSE}
library(readr)
library(stringr)
library(dplyr)
tournament_info_csv <- read_csv("tournamentinfocsv.csv")
```

#####display structure 
```{r}
str(tournament_info_csv)
```

###display first ten elements of num/state column 
```{r}
head(tournament_info_csv$`Num/State`)
```

###create a vector of player number 
```{r}
player_id <- grep(pattern = '[0-9]+', 
             tournament_info_csv$`Num/State`, value = TRUE)
```


###create a vector of player states
```{r}
player_state <- grep(pattern = '[A-Z]+', 
             tournament_info_csv$`Num/State`, value = TRUE)
```


###display first ten rows of each
```{r}

head(player_id)
head(player_state)
```

###create a dataframe of player id & his state
###converted the player id to numeric and allowed the state
###to be factors since they are categorical
```{r}
player_df <- data.frame(player_id, player_state)
```

###display details on df
```{r}
str(player_df)
table(player_df)
head(player_df)
```

###create a new vector of player points and add it as a column to
###the existing player df
```{r}
player_pts <- grep(pattern = '^[0-9]', 
                   tournament_info_csv$Pts, value = TRUE)
head(player_pts)
str(player_pts)
player_df$player_pts <- as.numeric(player_pts)
colnames(player_df)
str(player_df)
```


###create a new vector of player names and add it as a column to
###the existing player df
```{r}
player_name <- grep(pattern = '^[A-Z]+', 
                    tournament_info_csv$`Name/Rating`, value=TRUE)
player_df$player_name <- player_name
player_df <- player_df[, c(1,4,2,3)]
str(player_df)
```

###create a new vector of player ratings and add it as a column to
###the existing player df
```{r}
player_rating <-  str_extract(tournament_info_csv$`Name/Rating`,
                      "(:\\s{1,2}[0-9]{1,4})")
```


###remove NAs
```{r}
str(player_rating)
player_rating <- player_rating[!is.na(player_rating)]
str(player_rating)
```

###remove ': '
```{r}
player_rating <- str_replace(player_rating, pattern = ": ", "")
str(player_rating)
player_df$player_rating <- as.numeric(player_rating)
```

###create a new vector of player round1 opponents and add it as a column to
###the existing player df
```{r}
player_opp1 <-  str_extract(tournament_info_csv$`Round 1`,
                "([B]|[H]|[A-Z]\\s+[0-9]{1,2})")
player_opp1 <- player_opp1[!is.na(player_opp1)]
player_opp1 <- str_replace(player_opp1, pattern = "[A-Z]\\s{2,3}", "")
player_df$round1 <- player_opp1
```

###create a new vector of player round2 opponents and add it as a column to
###the existing player df
```{r}
player_opp2 <-  str_extract(tournament_info_csv$`Round 2`,
                         "([B]|[H]|[U]|[A-Z]\\s+[0-9]{1,2})")
player_opp2 <- player_opp2[!is.na(player_opp2)]
player_opp2 <- str_replace(player_opp2, pattern = "[A-Z]\\s{2,3}", "")
player_df$round2 <- player_opp2
```

###create a new vector of player round3 opponents and add it as a column to
###the existing player df
```{r}
player_opp3 <-  str_extract(tournament_info_csv$`Round 3`,
                            "([B]|[H]|[U]|[A-Z]\\s+[0-9]{1,2})")
player_opp3 <- player_opp3[!is.na(player_opp3)]
player_opp3 <- str_replace(player_opp3, pattern = "[A-Z]\\s{2,3}", "")
player_df$round3 <- player_opp3
```


###create a new vector of player round4 opponents and add it as a column to
###the existing player df
```{r}
player_opp4 <-  str_extract(tournament_info_csv$`Round 4`,
                            "([B]|[H]|[U]|[A-Z]\\s+[0-9]{1,2})")
player_opp4 <- player_opp4[!is.na(player_opp4)]
player_opp4 <- str_replace(player_opp4, pattern = "[A-Z]\\s{2}", "")
player_df$round4 <- player_opp4
```


###create a new vector of player round5 opponents and add it as a column to
###the existing player df
```{r}
player_opp5 <-  str_extract(tournament_info_csv$`Round 5`,
                     "([B]|[H]|[U]|[X]|[A-Z]\\s+[0-9]{1,2})")
player_opp5 <- player_opp5[!is.na(player_opp5)]
player_opp5 <- str_replace(player_opp5, pattern = "[A-Z]\\s{1,3}", "")
player_df$round5 <- player_opp5
```

###create a new vector of player round6 opponents and add it as a column to
###the existing player df
```{r}
player_opp6 <-  str_extract(tournament_info_csv$`Round 6`,
                            "([B]|[H]|[U]|[X]|[A-Z]\\s+[0-9]{1,2})")
player_opp6 <- player_opp6[!is.na(player_opp6)]
player_opp6 <- str_replace(player_opp6, pattern = "[A-Z]\\s{1,3}", "")
player_df$round6 <- player_opp6
```

###create a new vector of player round7 opponents and add it as a column to
###the existing player df
```{r}
player_opp7 <-  str_extract(tournament_info_csv$`Round 7`,
                            "([B]|[H]|[U]|[X]|[A-Z]\\s+[0-9]{1,2})")
player_opp7 <- player_opp7[!is.na(player_opp7)]
player_opp7 <- str_replace(player_opp7, pattern = "[A-Z]\\s{1,3}", "")
player_df$round7 <- player_opp7
```

###display complete data frame 
```{r}
head(player_df)
tail(player_df)
```


###create a tibble to replace oppet numbers with their rating
```{r}
player_tb <- as_tibble(player_df)
for (row in 1:nrow(player_df)) {
  if (player_df$round1[row] < 'A') {
    opp_tb <- filter(player_tb, player_id==player_df$round1[row])
    player_df$round1[row] <- opp_tb$player_rating
  }
}
player_df$round1    
player_tb <- as_tibble(player_df)
player_tb
```


